#!/usr/bin/bash

# run this as crontab, rather than a polybar module

# check for network
ping -c1 "debian.org"
if [[ $? -ne 0 ]] ; then
    echo "No network connection!" > /dev/stderr
    exit 2
fi

FILEPATH="$HOME/.cache/current_updates.txt"
UPAC="$(checkupdates | wc -l)"
UAUR="$(pikaur -Qua 2> /dev/null | wc -l)"

if [[ $UPAC -gt 0 ]] ; then
    if [[ $UPAC -eq 1 ]] ; then
        UPAC="$UPAC update"
    else
        UPAC="$UPAC updates"
    fi
else
    UPAC=""
fi

if [[ $UAUR -gt 0 ]] ; then
    if [[ -n $UPAC ]] ; then
        UAUR="; $UAUR aur"
    else
        UAUR="$UAUR aur"
    fi
else
    UAUR=""
fi

if [[ -n $UPAC || -n $UAUR ]] ; then
    echo "($UPAC$UAUR)" > "$FILEPATH"
else
    echo -n "" > "$FILEPATH"
fi
